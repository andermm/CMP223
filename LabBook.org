#+TITLE: LabBook
#+AUTHOR: Anderson Mattheus Maliszewski
#+STARTUP: overview indent
#+TAGS: noexport(n) deprecated(d) 
#+EXPORT_SELECT_TAGS: export
#+EXPORT_EXCLUDE_TAGS: noexport
#+SEQ_TODO: TODO(t!) STARTED(s!) WAITING(w!) | DONE(d!) CANCELLED(c!) DEFERRED(f!)

This LabBook is for the *CMP223 - Computer System Performance* *Analysis
(2019/2)* final work and has a wealth of informations about the entire
process used during the proposed experiments. To reproduce this
evaluation, you can follow the steps below. Have fun!

#+BEGIN_QUOTE
*Reporting errors*: This repository has several links to self-contained
 files as well as links from the Internet, so if you try to reproduce
 it and find broken links or other problems, please tell me everything
 so that I can improve it. :)
#+END_QUOTE

* Experimental Project
** Objective
   Assess the impact of the network interconnection on HPC
   applications. Both *InfiniBand (IB)* and *Gigabit Ethernet (ETH)*, as
   well as *IP-over-IB (IPoIB)* interconnections were evaluated using
   the same physical cluster of servers. The MPI-PingPong benchmark of
   the [[https://software.intel.com/en-us/articles/intel-mpi-benchmarks][Intel MPI Benchmarks]] suite was executed to first characterize
   the interconnection latency and throughput. Then two synthetic
   benchmarks (NPB and ImbBench) and one real application (Alya) were
   executed. [[https://www.nas.nasa.gov/publications/npb.html][NAS Parallel Benchmarks (NPB)]] set version 3.4 with input
   *class D* was used because it represent several patterns of real HPC
   applications, as well as being characterized as a balanced
   benchmarks set (when an MPI parallel application distributes work
   between processes evenly, and therefore all end almost together,
   making the best use of available resources). On the other hand,
   [[https://github.com/Roloff/ImbBench.git][Inbalanced Benchmark (IMB)]] was created to represent the more common
   inbalanced application patterns. Thus, with both of the mentioned
   benchmarks we cover the common HPC application and also the
   balanced and inbalanced patterns. [[https://www.bsc.es/research-development/research-areas/engineering-simulations/alya-high-performance-computational][Alya]] was used because this work
   tends to cover not only synthetic benchmarks which try to mimic
   real applications but rather use a real application.

** Benchmarks
Below is a brief overview about the benchmarks used.
*** Intel MPI Benchmark
The Intel® MPI Benchmarks perform a set of MPI performance
measurements for point-to-point and global communication operations
for a range of message sizes. The generated benchmark data fully
characterizes:
- Performance of a cluster system, including node performance, network
  latency, and throughput.
- Efficiency of the MPI implementation used.
There are several benchmarks included in this set, and in this
evaluation, only the MPI1 PingPong application was used to measure
interconnect latency and throughput.

*** NAS Parallel Benchmarks
The NAS Parallel Benchmarks (NPB) are a small set of programs designed
to help evaluate the performance of parallel supercomputers. The
benchmarks are derived from computational fluid dynamics (CFD)
applications. Problem sizes in NPB are predefined and indicated as
different classes.

In this evaluation, the original set of benchmarks from the NPB suite,
consisting of five kernels and three pseudo-applications were used
with the Messsage Passing Interface (MPI) parallel implementation.

Five Kernels:
- *IS* - Integer Sort, random memory access.
- *EP* - Embarrassingly Parallel.
- *CG* - Conjugate Gradient, irregular memory access and communication.
- *FT* - Discrete 3D fast Fourier Transform, all-to-all communication.
- *MG* - Multi-Grid on a sequence of meshes, long- and short-distance
  communication, memory intensive.

Three pseudo-applications: 
- *BT* - Block Tri-diagonal solver.
- *SP* - Scalar Penta-diagonal solver.
- *LU* - Lower-Upper Gauss-Seidel solver.

They were executed with 128 processes on 4 nodes, 32 processes per
node, in the case of IS, EP, CG, FT, MG, and LU (power-of-two). Since
BT and SP require that the number of processes to be a square root,
144 processes were used, with 36 processes in each node.

*** Inbalanced Benchmark
Imbalance Benchmark (ImbBench) is a set of MPI-based applications,
created by the Ph.D. Student Eduardo Roloff, that simulate several
behaviors in terms of process loads. ImbBench was designed with the
cloud heterogeneity in mind, and its goal is to help the user to
choose the most suitable configuration to execute an application in
the cloud. ImbBench distributes the load among all the available
processes according to a preselected imbalanced pattern.

ImbBench has a set of microbenchmarks and parameters to benchmark CPU
and Memory. In this evaluation, it was used both CPU and Memory
benchmarks with the 8Level pattern of imbalance and the Rand and BST
microbenchmarks, respectively.

*** Alya
Alya is a high performance computational mechanics code to solve
complex coupled multi-physics / multi-scale / multi-domain problems,
which are mostly coming from the engineering realm. Among the
different physics solved by Alya we can mention:
incompressible/compressible flows, non-linear solid mechanics,
chemistry, particle transport, heat transfer, turbulence modeling,
electrical propagation, etc.

** How to Reproduce it
To reproduce this project, the first step is to to clone the git repository in
the *$HOME* of the desired cluster of servers. 

#+begin_src shell :results output :exports both
cd $HOME; git clone https://github.com/andermm/CMP223
#+end_src

Here it is assumed that your HOME directory is exported with NFS. If
you don't have the NFS configured, [[https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nfs-mount-on-ubuntu-16-04][here]] is a tutorial to do it. If
this step is ok, go ahead to the other topics.

** Required Softwares
To execute the experiments, some required packages need to
be installed. They are:
- openmpi-bin - High performance message passing library (mpiexec).
- libopenmpi-dev - High performance message passing library (mpicc and
  mpifort).
- gfortran - GNU Fortran 95 compiler.
- cmake - Cross-platform, open-source make system.
- pajeng - Space-time view and associated tools for Paje trace files.

If your OS is Debian based and you have permission to install new
packages, you can install the required packages using the [[SH/software_install.sh][Software
Installer]] script. On the other hand, if you do not have permission to
do so, you can use the Spack package manager. The full tutorial on how
to use Spack can be seen [[https://spack-tutorial.readthedocs.io/en/latest/][here]].

** System Information 
   To collect the information of all nodes used in the evaluation, it
   was used the [[SH/sys_info_collect.sh][System Information Collect]] script, which creates the
   [[LOGS/env_info.org][System Information]] log output with ORG extension. The script
   executes automatically in the execution script.

** Network Infrastructure Information
Each node has a Mellanox MT27600 Channel Adapter (CA) configured for
the InfiniBand 56 Gb/s 4X FDR ConnectX-3 with firmware version
10.16.1038 and OFED version 4.6-1.0.1.1. All nodes are interconnected
through a Mellanox SX6036 FDR and a generic de 1 Gbps switch.

** Design of Experiments
   To execute benchmarks without bias, the DoE.base library was used
   to create Experiment Design (DoE). In DoE, two factors were used,
   applications and interface, with 30 random replications, totaling
   1080 (12 * 3 * 30) distinct executions. For the characterization of
   the applications, one random replication was performed totaling 33
   (11 * 3) distinct executions (the MPI PingPong benchmark was not
   performed in the characterization step).

Execution factors:
- Factor 1 - Apps: The applications name totaling 12 (~exec_bt~,
  ~exec_ep~, ~exec_cg~, ~exec_mg~, ~exec_lu~, ~exec_sp~, ~exec_is~, ~exec_ft~,
  ~exec_imb_memory~, ~exec_imb_CPU~, ~exec_intel~, and ~exec_alya~).
- Factor 2 - Interface: The network interface names, totaling 3 (~eth~,
  ~ib~, ~ipoib~).

Characterization factors:
- Factor 1 - Apps: The applications name totaling 11 (~charac_bt~,
  ~charac_ep~, ~charac_cg~, ~charac_mg~, ~charac_lu~, ~charac_sp~, ~charac_is~,
  ~charac_ft~, ~charac_imb_memory~, ~charac_imb_CPU~, and ~charac_alya~).
- Factor 2 - Interface: The network interface names, totaling 3 (~eth~,
  ~ib~, ~ipoib~).

Below is the R code block which generates the CSV files.
#+begin_src R :results output :session *R* :exports both
options(crayon.enabled=FALSE)
library(DoE.base)
library(tidyverse)

set.seed(0)
  cmp223_exec <- fac.design(factor.names = list(
    apps = c("exec_bt", "exec_ep", "exec_cg", "exec_mg", "exec_lu",
             "exec_sp", "exec_is", "exec_ft", "exec_imb_memory",
             "exec_imb_CPU", "exec_intel", "exec_alya"),
    interface = c("eth", "ib", "ipoib")),
    replications=30,
    randomize=TRUE)

cmp223_exec %>%
  select(-Blocks) %>%
  mutate(number=1:n()) -> cmp223_exec
write_csv(cmp223_exec, "R/experimental_project_exec.csv")
#+end_src

#+RESULTS:
: 
: creating full factorial with 36 runs ...

#+begin_src R :results output :session *R* :exports both
options(crayon.enabled=FALSE)
library(DoE.base)
library(tidyverse)

set.seed(0)
  cmp223_charac <- fac.design(factor.names = list(
    apps = c("charac_bt", "charac_ep", "charac_cg", "charac_mg", "charac_lu",
             "charac_sp", "charac_is", "charac_ft", "charac_imb_memory",
             "charac_imb_CPU", "charac_alya"),
    interface = c("eth", "ib", "ipoib")),
    replications=1,
    randomize=TRUE)

cmp223_charac %>%
  mutate(number=1:n()) -> cmp223_charac
write_csv(cmp223_charac, "R/experimental_project_charac.csv")
#+end_src

#+RESULTS:
: 
: creating full factorial with 33 runs ...

** Bash Scripts Descriptions
- [[SH/experiments_exec.sh][Experiments Execution]] - This is the most essential script for this
  evaluation. It comprises from the beginning, when the variables are
  defined, until the end, when the experiments execution ends. To
  describe it, it has been divided into a few steps, which are:

  - *Step 1*: Define the variables and Create the Folders - Here all the
    variables with folders, software and bencharmark locations are
    defined and created.
  - *Step 2*: Collect System Information - In this step, the Execution
    Experiments script calls the System Information script to collect
    information about all nodes used in the evaluation.
  - *Step 3*: Download and Compile the Programs - Here all the softwares
    and benchmarks are downloaded and compiled with their respective
    compilers.
  - *Step 4*: Define Machine Files and Experimental Project - In this
    step the machine files and experimental project used during MPI
    execution are defined.
  - *Step 5*: Read the Experimental Project and Start the Execution
    Loop - This step reads the experimental project, start the MPI
    command line, and executes the experiments with their respective
    interconnection/application. At the end of each execution, the
    results are sent to the log files.
  - *Step 6*: Call the Experiment Characterization Script - This final
    step calls the experiment characterization script to start the
    characterization execution. Characterization and "normal"
    execution are done one after another because in characterization,
    the execution trace process records all the MPI primitives in a
    file and therefore can interfer in the normal execution
    considering resources usage (e.g., IO).
- [[SH/experiments_charac.sh][Experiments Characterization]] - This script is similar to the one
  discribed above, however, it only performs the experiment
  characterization, subdivided into three steps, which are:

  - *Step 1*: A first definition of the variables.
  - *Step 2*: Definition of the Machines Files and Experimental Project.
  - *Step 3*: Read the Experimental Project and Start the Execution Loop

- [[SH/central.sh][Central]] - This script was created to allocate the nodes using the
  ~salloc~ command from Slurm Workload Manager and then pass the bash
  script execution command through ssh to start the Experiments
  Execution.
- [[SH/software_install.sh][Software Installation]] - This script is basically a simple loop to
  check whether packages within the 'name' vector are installed or
  not. If so, them ok. Otherwise, install the packages that are not
  installed. This script assume that the user has sudo
  privilegies. Otherwise, go to the *Software Installation* session,
  which will describe how to install the software using Spack packet
  manager.
- [[SH/sys_info_collect.sh][System Information Collect]] - This is a crucial script to performance
  evaluations, which is executed before the benchmarks. It saves all the
  system information and sends the output to an ORG file. This output
  will undoubtedly help describe the results or even add system
  information to the paper/report.

** Experiments Execution
The scripts in this work are designed for use in a cluster with Slurm
job scheduler. Here, to start the experiments, the [[SH/central.sh][central script]] was
first executed, which allocates the necessary nodes, in this case,
hype2, hype3, hype4, and hype5, and passes through ssh the bash
command that calls the [[SH//experiments_exec.sh][experiments execution]] script. This script first
calls the [[SH/sys_info_collect.sh][system information]] script to collect system
information. Next, it executes the experiments and, at the end,
requests that the [[SH/experiments_charac.sh][experiments characterization]] script to start the
characterization execution.

To reproduce this evaluation in an environment without Slurm job
scheduler, simply clone this repository into the server's HOME
directory, set the server names in the PARTITION variable ([[SH/experiments_exec.sh][experiments
execution]] script line 66), adjust the machine files in [[MACHINE_FILES][Machine Files]]
folder also with the name of the servers, adjust the number of
processes (in [[SH/experiments_exec.sh][experiments execution]] script lines 237, 240, 243 and,
246 and in [[SH/experiments_charac.sh][experiments characterization]] script lines 93, 96 and, 99)
to be used during the execution, respecting the power of two or square
root requirements, and finally executes the [[SH/experiments_exec.sh][experiments execution]]
script like a normal bash script.

** Graphical Analysis 
Upon completion of the experiments, in this topic, graphs containing
the execution time and the characterization of the applications are
created. The first step is to read the CSV files. Latency and
bandwidth graphs are then created. Finally, applications graphs are
created according to the number of processes, in which BT and SP have
144 and according to a similar execution time range.

*** Execution Time Plots
**** Read CSVs
#+begin_src R :results output :session *R* :exports both
options(crayon.enabled=FALSE)
suppressMessages(library("tidyverse"));
df_intel <- read_csv("LOGS/intel.22-11-2019.16h44m04s.csv", progress=FALSE)
df_apps <- read_csv("LOGS/apps_exec.22-11-2019.16h44m04s.csv", progress=FALSE)
    
df_apps %>%
      group_by(apps,interface) %>%
      summarise(
        average=mean(time),
        std=sd(time),
        ste=3*std/sqrt(n()),
        N=n()) %>%
      arrange(apps,interface) -> df_apps
df_apps

df_intel %>%
  filter(bytes != 0) %>%
  group_by(interface,bytes) %>%
  summarise(
    average=mean(time),
    std=sd(time),
    ste=3*std/sqrt(n()),
    N=n()) %>%
  arrange(interface,bytes) -> df_intel_latency
df_intel_latency

df_intel %>%
  filter(bytes != 0) %>%
  group_by(interface,bytes) %>%
  summarise(
    average=mean(`mbytes-sec`),
    std=sd(`mbytes-sec`),
    ste=3*std/sqrt(n()),
    N=n()) %>%
  arrange(interface,bytes) -> df_intel_band
df_intel_band

#+end_src

#+RESULTS:
#+begin_example

Parsed with column specification:
cols(
  apps = col_character(),
  interface = col_character(),
  bytes = col_double(),
  time = col_double(),
  `mbytes-sec` = col_double()
)

Parsed with column specification:
cols(
  apps = col_character(),
  interface = col_character(),
  time = col_double()
)

# A tibble: 33 x 6
# Groups:   apps [11]
   apps      interface average   std   ste     N
   <
    <
      <
<
<
<int>
 1 exec_alya eth         297.  1.77  0.968    30
 2 exec_alya ib          254.  2.79  1.53     30
 3 exec_alya ipoib       281.  2.90  1.59     30
 4 exec_bt   eth         505.  1.54  0.842    30
 5 exec_bt   ib          380.  4.17  2.28     30
 6 exec_bt   ipoib       544.  3.51  1.92     30
 7 exec_cg   eth         761.  8.24  4.51     30
 8 exec_cg   ib          183.  1.01  0.551    30
 9 exec_cg   ipoib       181.  2.58  1.41     30
10 exec_ep   eth          37.4 0.422 0.231    30
# … with 23 more rows

# A tibble: 69 x 6
# Groups:   interface [3]
   interface bytes average   std   ste     N
   <
    <
  <
<
<
<int>
 1 eth           1    6.42 0.456 0.250    30
 2 eth           2    6.28 0.470 0.257    30
 3 eth           4    6.18 0.472 0.258    30
 4 eth           8    6.07 0.381 0.209    30
 5 eth          16    6.02 0.338 0.185    30
 6 eth          32    5.98 0.301 0.165    30
 7 eth          64    5.98 0.280 0.153    30
 8 eth         128    5.99 0.272 0.149    30
 9 eth         256    5.99 0.247 0.136    30
10 eth         512    6.02 0.218 0.119    30
# … with 59 more rows

# A tibble: 69 x 6
# Groups:   interface [3]
   interface bytes average    std     ste     N
   <
    <
  <
 <
  <
<int>
 1 eth           1   0.157 0.0106 0.00578    30
 2 eth           2   0.320 0.0230 0.0126     30
 3 eth           4   0.651 0.0487 0.0267     30
 4 eth           8   1.32  0.0821 0.0450     30
 5 eth          16   2.67  0.147  0.0803     30
 6 eth          32   5.36  0.264  0.145      30
 7 eth          64  10.7   0.488  0.267      30
 8 eth         128  21.4   0.945  0.518      30
 9 eth         256  42.8   1.72   0.940      30
10 eth         512  85.2   2.98   1.63       30
# … with 59 more rows
#+end_example
**** PingPong - Latency
#+begin_src R :results output graphics :file R/PLOTS/PingPong.png :exports both :width 800 :height 600 :session *R* 
ggplot(df_intel_latency,aes(x=bytes, y=average)) +
  geom_line(aes(color = interface), alpha = 1) +
  geom_point(aes(color=interface, shape=interface),size = 4) +
  scale_shape_manual(values = c(15, 16, 17),
                     breaks=c("ib", "ipoib", "eth"),
                     labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +
  geom_errorbar(aes(ymin=average-ste, ymax=average+ste, color=interface, group=interface), width = .2) +
  theme_bw() +
  scale_y_log10(breaks=c(0, 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024)) +
  scale_x_log10(breaks=c(0, 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536, 131072, 262144, 524288, 1048576, 2097152, 4194304)) +
  ylab('Average Latency Time\n(Microseconds in 2 Log Scale)') +
  xlab('Message Size (Bytes)') +
  scale_color_manual(values=c( "#BEBEBE", "#303030", "#888888"),
                    breaks=c("ib", "ipoib", "eth"),
                    labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +
    theme (legend.position = c(0.15, 0.85),
           legend.background = element_rect(color = "black", size = 0.5, linetype = "solid"),
           plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
           axis.title=element_text(size=18), 
           legend.title = element_blank(),
           legend.text = element_text(color = "black", size = 18),
           axis.text.x = element_text(angle=55, hjust=1, size =16, color = "black"),
           axis.text.y = element_text(size =16, color = "black"))
#+end_src

#+RESULTS:
[[file:R/PLOTS/PingPong.png]]

**** PingPong - Bandwidth
#+begin_src R :results output graphics :file R/PLOTS/Bandwidth.png :exports both :width 800 :height 600 :session *R* 
ggplot(df_intel_band,aes(x=bytes, y=average)) +
  geom_line(aes(col = interface), alpha = 1) +
  geom_point(aes(col = interface, shape=interface), size = 4) +
  scale_shape_manual(values = c(15, 16, 17),
                     breaks=c("ib", "ipoib", "eth"),
                     labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +  
  geom_errorbar(aes(ymin=average-ste, ymax=average+ste, color=interface, group=interface), width = .2) +
  theme_bw() +
  scale_y_continuous(breaks=c(0,1000,2000,3000,4000,5000,6000,7000,8000)) +
  scale_x_log10(breaks=c(0, 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536, 131072, 262144, 524288, 1048576, 2097152, 4194304)) +
  ylab('Average Bandwidth\n(Megabytes per Second)') +
  xlab('Message Size (Bytes)') +
  scale_colour_manual(values=c( "#BEBEBE", "#303030", "#888888"),
                    breaks=c("ib", "ipoib", "eth"),
                    labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +
  theme (legend.position = c(0.15, 0.85),
         legend.background = element_rect(color = "black", size = 0.3, linetype = "solid"),
          plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
         axis.title=element_text(size=18), 
         legend.title = element_blank(),
         legend.text = element_text(color = "black", size = 18),
         axis.text.x = element_text(angle=55, hjust=1, size =16, color = "black"),
         axis.text.y = element_text(size =16, color = "black"))
#+end_src

#+RESULTS:
[[file:R/PLOTS/Bandwidth.png]]

**** FT-EP-IS-SP
#+begin_src R :results output graphics :file R/PLOTS/FT_EP_IS_SP.png :exports both :width 800 :height 400 :session *R*
try <- c(exec_ft="FT", exec_sp="SP",  exec_ep="EP", exec_is="IS")
try2 <- c(exec_ft="128", exec_sp="144",  exec_ep="128", exec_is="128")
df_apps$interface <- factor(df_apps$interface,
levels=c("ib", "ipoib", "eth"))

count <- 0
breaks_fun <- function(x) {
  count <<- count + 1L
  switch(
    count,
    c(0,10,20,30,40),
    c(0,400,800,1200,1600),
    c(0,50,100,150),
    c(0,200,400,600,800)
  )
}

ggplot(df_apps[df_apps$apps %in% c("exec_ft", "exec_sp", "exec_ep", "exec_is"), ] , aes(x=reorder(apps, +average), y=average, fill=interface)) +
geom_bar(stat="identity", position = "dodge", width = 0.6) +
geom_errorbar(aes(ymin=average-ste, ymax=average+ste), width=0.2, position = position_dodge(.6)) +
theme_bw() +
scale_fill_manual(values=c("#303030", "#888888", "#BEBEBE") ,
breaks=c("ib", "ipoib", "eth"), labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +
theme(legend.position = "top", 
      legend.key = element_rect(colour = "grey"),
      legend.key.height = unit(0.5, "line"),
      legend.key.width = unit(4, "line"),
      legend.spacing = unit(100, "line"),
      plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
      legend.margin=margin(c(0, 0, -8, 0)),
      axis.text.x = element_text(size =16, color = "black"),
      axis.text.y = element_text(size =16, color = "black"),
      axis.title=element_text(size=18), 
      legend.title = element_blank(),
      legend.text = element_text(color = "black", size = 18)) +
      scale_x_discrete(labels=try2) +
      labs(x="Number of MPI Processes", y="Execution Time in Seconds") +
      facet_wrap(facets= ~ apps, scales="free", labeller=labeller(apps=try), nrow=1) +
      scale_y_continuous(breaks = breaks_fun, limits = c(0, NA)) + 
      theme(strip.text.x=element_text(size=18),
            strip.background=element_rect(fill='#F5F5F5'))
     
#+end_src

#+RESULTS:
[[file:R/PLOTS/FT_EP_IS_SP.png]]

**** MG-CG-LU-BT
#+begin_src R :results output graphics :file R/PLOTS/MG_CG_LU_BT.png :exports both :width 800 :height 400 :session *R*
try <- c(exec_mg="MG", exec_cg="CG",  exec_lu="LU", exec_bt="BT")
try2 <- c(exec_mg="128", exec_cg="128",  exec_lu="128", exec_bt="144")
df_apps$interface <- factor(df_apps$interface,
levels=c("ib", "ipoib", "eth"))


count <- 0
breaks_fun <- function(x) {
  count <<- count + 1L
  switch(
    count,
    c(0,110,220,330,440,550),
    c(0,200,400,600,800),
    c(0,100,200,300),
    c(0,20,40,60,80)
  )
}

ggplot(df_apps[df_apps$apps %in% c("exec_mg", "exec_cg", "exec_lu", "exec_bt"), ] , aes(x=reorder(apps, +average), y=average, fill=interface)) +
geom_bar(stat="identity", position = "dodge", width = 0.6) +
geom_errorbar(aes(ymin=average-ste, ymax=average+ste), width=0.2, position = position_dodge(.6)) +
theme_bw() +
scale_fill_manual(values=c("#303030", "#888888", "#BEBEBE") ,
breaks=c("ib", "ipoib", "eth"), labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +
theme(legend.position = "top", 
      legend.key = element_rect(colour = "grey"),
      legend.key.height = unit(0.5, "line"),
      legend.key.width = unit(4, "line"),
      legend.spacing = unit(100, "line"),
      plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
      legend.margin=margin(c(0, 0, -8, 0)),
      axis.text.x = element_text(size =16, color = "black"),
      axis.text.y = element_text(size =16, color = "black"),
      axis.title=element_text(size=18), 
      legend.title = element_blank(),
      legend.text = element_text(color = "black", size = 18)) +
      scale_x_discrete(labels=try2) +
      labs(x="Number of MPI Processes", y="Execution Time in Seconds") +
      facet_wrap(facets= ~ apps, scales="free", labeller=labeller(apps=try), nrow=1) +
      scale_y_continuous(breaks = breaks_fun, limits = c(0, NA)) +
      theme(strip.text.x=element_text(size=18),
            strip.background=element_rect(fill='#F5F5F5'))
#+end_src

#+RESULTS:
[[file:R/PLOTS/MG_CG_LU_BT.png]]

**** Alya-IMB
#+begin_src R :results output graphics :file R/PLOTS/Alya-IMB.png :exports both :width 800 :height 400 :session *R*  
try <- c(exec_alya="Alya",exec_imb_memory="ImbBench-Memory\n8Level", exec_imb_CPU="ImbBench-CPU\n8Level")
try2 <- c(exec_alya="160", exec_imb_memory="160", exec_imb_CPU="160")
df_apps$interface <- factor(df_apps$interface,
levels=c("ib", "ipoib", "eth"))

count <- 0
breaks_fun <- function(x) {
  count <<- count + 1L
  switch(
    count,
    c(0,100,200,300),
    c(0,3,6,9),
    c(0,7,14,21,28)
  )
}

ggplot(df_apps[df_apps$apps %in% c("exec_alya", "exec_imb_memory", "exec_imb_CPU"), ] , aes(x=apps, y=average, fill=interface)) +
geom_bar(stat="identity", position = "dodge", width = 0.4) +
geom_errorbar(aes(ymin=average-ste, ymax=average+ste), width=.1, position = position_dodge(.4)) +
theme_bw() +
scale_fill_manual(values=c("#303030", "#888888", "#BEBEBE"),
breaks=c("ib", "ipoib", "eth"), labels=c("InfiniBand", "IP-over-IB", "Ethernet")) +
theme(legend.position = "top", 
      legend.key = element_rect(colour = "grey"),
      legend.key.height = unit(0.5, "line"),
      legend.key.width = unit(4, "line"),
      legend.spacing = unit(100, "line"),
      plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
      legend.margin=margin(c(0, 0, -8, 0)),
      axis.text.x = element_text(size =16, color = "black"),
      axis.text.y = element_text(size =16, color = "black"),
      axis.title=element_text(size=18), 
      legend.title = element_blank(),
      legend.text = element_text(color = "black", size = 18)) +
      scale_x_discrete(labels=try2) +
      labs(x="Number of MPI Processes", y="Execution Time in Seconds") +
      facet_wrap(facets= ~ apps, scales="free", labeller=labeller(apps=try), nrow=1) +
      scale_y_continuous(breaks = breaks_fun, limits = c(0, NA)) + 
      theme(strip.text.x=element_text(size=18),
            strip.background=element_rect(fill='#F5F5F5'))



#+end_src

#+RESULTS:
[[file:R/PLOTS/Alya-IMB.png]]
*** Characterization Plots
**** FT-EP-IS-SP
***** Read CSVs
#+begin_src R :results output :session *R* :exports both
options(crayon.enabled=FALSE)
suppressMessages(library(tidyverse))
df.ft <- read_csv("LOGS/TRACE/charac_ft.eth/charac_ft.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "FT") %>%
  select(Rank, everything())
df.ft

df.ep <- read_csv("LOGS/TRACE/charac_ep.eth/charac_ep.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "EP") %>%
  select(Rank, everything())
df.ep

df.is <- read_csv("LOGS/TRACE/charac_is.eth/charac_is.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IS") %>%
  select(Rank, everything())
df.is

df.sp <- read_csv("LOGS/TRACE/charac_sp.eth/charac_sp.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "SP") %>%
  select(Rank, everything())
df.sp
#+end_src

#+RESULTS:
#+begin_example

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 8,193 x 6
    Rank Start   End Duration Value          App  
   <
<
<
   <
<
         <chr>
 1    99 0.779  1.52 0.745    MPI_Init       FT   
 2    99 1.52   1.52 0.000001 MPI_Comm_size  FT   
 3    99 1.52   1.52 0        MPI_Comm_rank  FT   
 4    99 1.52   1.53 0.00158  MPI_Bcast      FT   
 5    99 1.53   1.53 0.000094 MPI_Bcast      FT   
 6    99 1.53   1.53 0.000101 MPI_Bcast      FT   
 7    99 1.53   1.53 0.000054 MPI_Bcast      FT   
 8    99 1.53   1.53 0.000001 MPI_Bcast      FT   
 9    99 1.53   1.53 0.00254  MPI_Comm_split FT   
10    99 1.53   1.53 0.00188  MPI_Comm_split FT   
# … with 8,183 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 1,280 x 6
    Rank  Start   End Duration Value         App  
   <
 <
<
   <
<
        <chr>
 1    99  0.800  1.72 0.920    MPI_Init      EP   
 2    99  1.72   1.72 0.000001 MPI_Comm_rank EP   
 3    99  1.72   1.72 0        MPI_Comm_size EP   
 4    99  1.72   1.72 0.00199  MPI_Bcast     EP   
 5    99  1.72   1.72 0.000323 MPI_Barrier   EP   
 6    99 38.3   38.9  0.595    MPI_Allreduce EP   
 7    99 38.9   38.9  0.000558 MPI_Allreduce EP   
 8    99 38.9   38.9  0.000432 MPI_Allreduce EP   
 9    99 38.9   38.9  0.000344 MPI_Allreduce EP   
10    99 38.9   38.9  0.000841 MPI_Finalize  EP   
# … with 1,270 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 5,501 x 6
    Rank  Start   End  Duration Value         App  
   <
 <
<
    <
<
        <chr>
 1    99  0.740  1.56  0.816    MPI_Init      IS   
 2    99  1.56   1.56  0.000005 MPI_Comm_rank IS   
 3    99  1.56   1.56  0.000002 MPI_Comm_size IS   
 4    99  1.56   1.56  0.00164  MPI_Bcast     IS   
 5    99  3.99   5.24  1.25     MPI_Allreduce IS   
 6    99  5.24   5.25  0.00662  MPI_Alltoall  IS   
 7    99  5.25  22.9  17.6      MPI_Alltoallv IS   
 8    99 23.6   23.6   0.0828   MPI_Allreduce IS   
 9    99 23.6   23.6   0.00164  MPI_Alltoall  IS   
10    99 23.6   38.1  14.5      MPI_Alltoallv IS   
# … with 5,491 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 15,226,704 x 6
    Rank Start   End Duration Value          App  
   <
<
<
   <
<
         <chr>
 1   143 0.386  1.24 0.853    MPI_Init       SP   
 2   143 1.24   1.24 0.000004 MPI_Comm_size  SP   
 3   143 1.24   1.24 0        MPI_Comm_rank  SP   
 4   143 1.24   1.24 0.00253  MPI_Comm_split SP   
 5   143 1.24   1.24 0.000001 MPI_Comm_size  SP   
 6   143 1.24   1.24 0.00192  MPI_Comm_dup   SP   
 7   143 1.24   1.25 0.00187  MPI_Comm_dup   SP   
 8   143 1.25   1.25 0.00134  MPI_Bcast      SP   
 9   143 1.25   1.25 0.000147 MPI_Bcast      SP   
10   143 1.25   1.25 0.000093 MPI_Bcast      SP   
# … with 15,226,694 more rows
#+end_example

***** Plots
#+begin_src R :results output graphics :file R/PLOTS/FT-EP-IS-SP.charac.png :exports both :width 800 :height 400 :session *R* 
df <- rbind(df.ft, df.ep, df.is, df.sp)

df %>%
  filter(Value != "MPI_Finalize") %>%
  group_by(Rank,App) %>%
  summarize(MPI.Time = sum(Duration),
            Full.Time = max(End) - min(Start)) %>%
  mutate(Compute.Time = Full.Time - MPI.Time) %>%
  mutate(Comm.Ratio = MPI.Time / Full.Time * 100) %>%
  arrange(Rank) -> df.timings;
df.timings

df %>%
  group_by(Rank,App) %>%
  summarize(Time = max(End) - min(Start) - sum(Duration)) %>%
  mutate(Value = "Computing") -> df.compute
df.compute

df %>%
  filter(Value != "MPI_Finalize") %>%
  group_by(Rank,Value,App) %>%
  summarize(Time = sum(Duration)) -> df.communication;

df.communication$Value <- as.character(df.communication$Value)
df.communication$Value [grepl('MPI_*', df.communication$Value)] <- 'MPI'

df.communication %>%
  group_by(Rank, Value,App) %>%
  summarize(Time = sum(Time)) -> df.communication;

count <- 0
breaks_fun <- function(x) {
  count <<- count + 1L
  switch(
    count,
    c(0, 60, 127),
    c(0, 60, 127),
    c(0, 60, 127),
    c(0, 70, 143)
  )
}

count1 <- 0
breaks_fun2 <- function(x) {
  count1 <<- count1 + 1L
  switch(
    count1,
    c(0, 10,20,30,40),
    c(0, 400,800,1200,1600),
    c(0, 60,120,180),
    c(0, 200,400,600,800)
  )
}

df.compute %>%
  bind_rows(df.communication) %>%
  ggplot(aes(x = Rank, y = Time, fill=Value)) +
  geom_bar(stat='identity', width=1) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  theme_bw() +
  theme(legend.position="top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
        labs(x="Number of MPI Ranks", y="Execution Time in Seconds") +
        facet_wrap(facets= ~ App, scales="free", nrow=1) +
        scale_x_continuous(breaks = breaks_fun, limits = c(0, NA)) +
        scale_y_continuous(breaks = breaks_fun2, limits = c(0, NA)) +
        theme(strip.text.x=element_text(size=18),
        strip.background=element_rect(fill='#F5F5F5'))
#+end_src

#+RESULTS:
[[file:R/PLOTS/FT-EP-IS-SP.charac.png]]
***** Percentage
#+begin_src R :results output graphics :file R/PLOTS/FT-EP-IS-SP.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.ft <- read_csv("LOGS/TRACE/charac_ft.eth/charac_ft.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "FT") %>%
  select(Rank, everything())
df.ft

df.ft %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ft

df.ft$Value <- as.character(df.ft$Value)
df.ft$Value [grepl('MPI_*', df.ft$Value)] <- 'MPI'

df.ft %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ft$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ft;
df.percent.ft

df.ft$Value <- as.character(df.ft$Value)
df.ft$Value [grepl('MPI', df.ft$Value)] <- 'Computing'

df.ft %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ft$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ft

df.ep <- read_csv("LOGS/TRACE/charac_ep.eth/charac_ep.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "EP") %>%
  select(Rank, everything())
df.ep

df.ep %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ep

df.ep$Value <- as.character(df.ep$Value)
df.ep$Value [grepl('MPI_*', df.ep$Value)] <- 'MPI'

df.ep %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ep$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ep;
df.percent.ep

df.ep$Value <- as.character(df.ep$Value)
df.ep$Value [grepl('MPI', df.ep$Value)] <- 'Computing'

df.ep %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ep$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ep

df.is <- read_csv("LOGS/TRACE/charac_is.eth/charac_is.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IS") %>%
  select(Rank, everything())
df.is

df.is %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.is

df.is$Value <- as.character(df.is$Value)
df.is$Value [grepl('MPI_*', df.is$Value)] <- 'MPI'

df.is %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.is$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.is;
df.percent.is

df.is$Value <- as.character(df.is$Value)
df.is$Value [grepl('MPI', df.is$Value)] <- 'Computing'

df.is %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.is$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.is

df.sp <- read_csv("LOGS/TRACE/charac_sp.eth/charac_sp.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "SP") %>%
  select(Rank, everything())
df.sp

df.sp %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.sp

df.sp$Value <- as.character(df.sp$Value)
df.sp$Value [grepl('MPI_*', df.sp$Value)] <- 'MPI'

df.sp %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.sp$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.sp;
df.percent.sp

df.sp$Value <- as.character(df.sp$Value)
df.sp$Value [grepl('MPI', df.sp$Value)] <- 'Computing'

df.sp %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.sp$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.sp

df <- rbind(df.comp.ft,df.comp.ep,df.comp.is, df.comp.sp, df.percent.ft, df.percent.ep, df.percent.is, df.percent.sp)

  ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")
#+end_src

#+RESULTS:
[[file:R/PLOTS/FT-EP-IS-SP.charac.percentage.png]]
***** FT-Percentage
#+begin_src R :results output graphics :file R/PLOTS/FT.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.ft.ib <- read_csv("LOGS/TRACE/charac_ft.ib/charac_ft.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "FT.ib") %>%
  select(Rank, everything())
df.ft.ib

df.ft.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ft.ib

df.ft.ib$Value <- as.character(df.ft.ib$Value)
df.ft.ib$Value [grepl('MPI_*', df.ft.ib$Value)] <- 'MPI'

df.ft.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ft.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ft.ib;
df.percent.ft.ib

df.ft.ib$Value <- as.character(df.ft.ib$Value)
df.ft.ib$Value [grepl('MPI', df.ft.ib$Value)] <- 'Computing'

df.ft.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ft.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ft.ib

df.ft.ipoib <- read_csv("LOGS/TRACE/charac_ft.ipoib/charac_ft.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "FT.ipoib") %>%
  select(Rank, everything())
df.ft.ipoib

df.ft.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ft.ipoib

df.ft.ipoib$Value <- as.character(df.ft.ipoib$Value)
df.ft.ipoib$Value [grepl('MPI_*', df.ft.ipoib$Value)] <- 'MPI'

df.ft.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ft.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ft.ipoib;
df.percent.ft.ipoib

df.ft.ipoib$Value <- as.character(df.ft.ipoib$Value)
df.ft.ipoib$Value [grepl('MPI', df.ft.ipoib$Value)] <- 'Computing'

df.ft.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ft.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ft.ipoib

df.ft.eth <- read_csv("LOGS/TRACE/charac_ft.eth/charac_ft.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "FT.eth") %>%
  select(Rank, everything())
df.ft.eth

df.ft.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ft.eth

df.ft.eth$Value <- as.character(df.ft.eth$Value)
df.ft.eth$Value [grepl('MPI_*', df.ft.eth$Value)] <- 'MPI'

df.ft.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ft.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ft.eth;
df.percent.ft.eth

df.ft.eth$Value <- as.character(df.ft.eth$Value)
df.ft.eth$Value [grepl('MPI', df.ft.eth$Value)] <- 'Computing'

df.ft.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ft.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ft.eth

df <- rbind(df.comp.ft.eth, df.comp.ft.ib, df.comp.ft.ipoib, df.percent.ft.eth, df.percent.ft.ib, df.percent.ft.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

#+RESULTS:
[[file:R/PLOTS/FT.charac.percentage.png]]
***** EP-Percentage
#+begin_src R :results output graphics :file R/PLOTS/EP.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.ep.ib <- read_csv("LOGS/TRACE/charac_ep.ib/charac_ep.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "EP.ib") %>%
  select(Rank, everything())
df.ep.ib

df.ep.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ep.ib

df.ep.ib$Value <- as.character(df.ep.ib$Value)
df.ep.ib$Value [grepl('MPI_*', df.ep.ib$Value)] <- 'MPI'

df.ep.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ep.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ep.ib;
df.percent.ep.ib

df.ep.ib$Value <- as.character(df.ep.ib$Value)
df.ep.ib$Value [grepl('MPI', df.ep.ib$Value)] <- 'Computing'

df.ep.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ep.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ep.ib

df.ep.ipoib <- read_csv("LOGS/TRACE/charac_ep.ipoib/charac_ep.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "EP.ipoib") %>%
  select(Rank, everything())
df.ep.ipoib

df.ep.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ep.ipoib

df.ep.ipoib$Value <- as.character(df.ep.ipoib$Value)
df.ep.ipoib$Value [grepl('MPI_*', df.ep.ipoib$Value)] <- 'MPI'

df.ep.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ep.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ep.ipoib;
df.percent.ep.ipoib

df.ep.ipoib$Value <- as.character(df.ep.ipoib$Value)
df.ep.ipoib$Value [grepl('MPI', df.ep.ipoib$Value)] <- 'Computing'

df.ep.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ep.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ep.ipoib

df.ep.eth <- read_csv("LOGS/TRACE/charac_ep.eth/charac_ep.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "EP.eth") %>%
  select(Rank, everything())
df.ep.eth

df.ep.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.ep.eth

df.ep.eth$Value <- as.character(df.ep.eth$Value)
df.ep.eth$Value [grepl('MPI_*', df.ep.eth$Value)] <- 'MPI'

df.ep.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.ep.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.ep.eth;
df.percent.ep.eth

df.ep.eth$Value <- as.character(df.ep.eth$Value)
df.ep.eth$Value [grepl('MPI', df.ep.eth$Value)] <- 'Computing'

df.ep.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.ep.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.ep.eth

df <- rbind(df.comp.ep.eth, df.comp.ep.ib, df.comp.ep.ipoib, df.percent.ep.eth, df.percent.ep.ib, df.percent.ep.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

#+RESULTS:
[[file:R/PLOTS/EP.charac.percentage.png]]

***** IS-Percentage
#+begin_src R :results output graphics :file R/PLOTS/IS.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.is.ib <- read_csv("LOGS/TRACE/charac_is.ib/charac_is.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IS.ib") %>%
  select(Rank, everything())
df.is.ib

df.is.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.is.ib

df.is.ib$Value <- as.character(df.is.ib$Value)
df.is.ib$Value [grepl('MPI_*', df.is.ib$Value)] <- 'MPI'

df.is.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.is.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.is.ib;
df.percent.is.ib

df.is.ib$Value <- as.character(df.is.ib$Value)
df.is.ib$Value [grepl('MPI', df.is.ib$Value)] <- 'Computing'

df.is.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.is.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.is.ib

df.is.ipoib <- read_csv("LOGS/TRACE/charac_is.ipoib/charac_is.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IS.ipoib") %>%
  select(Rank, everything())
df.is.ipoib

df.is.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.is.ipoib

df.is.ipoib$Value <- as.character(df.is.ipoib$Value)
df.is.ipoib$Value [grepl('MPI_*', df.is.ipoib$Value)] <- 'MPI'

df.is.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.is.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.is.ipoib;
df.percent.is.ipoib

df.is.ipoib$Value <- as.character(df.is.ipoib$Value)
df.is.ipoib$Value [grepl('MPI', df.is.ipoib$Value)] <- 'Computing'

df.is.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.is.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.is.ipoib

df.is.eth <- read_csv("LOGS/TRACE/charac_is.eth/charac_is.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IS.eth") %>%
  select(Rank, everything())
df.is.eth

df.is.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.is.eth

df.is.eth$Value <- as.character(df.is.eth$Value)
df.is.eth$Value [grepl('MPI_*', df.is.eth$Value)] <- 'MPI'

df.is.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.is.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.is.eth;
df.percent.is.eth

df.is.eth$Value <- as.character(df.is.eth$Value)
df.is.eth$Value [grepl('MPI', df.is.eth$Value)] <- 'Computing'

df.is.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.is.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.is.eth

df <- rbind(df.comp.is.eth, df.comp.is.ib, df.comp.is.ipoib, df.percent.is.eth, df.percent.is.ib, df.percent.is.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

#+RESULTS:
[[file:R/PLOTS/IS.charac.percentage.png]]

***** SP-Percentage
#+begin_src R :results output graphics :file R/PLOTS/SP.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.sp.ib <- read_csv("LOGS/TRACE/charac_sp.ib/charac_sp.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "SP.ib") %>%
  select(Rank, everything())
df.sp.ib

df.sp.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.sp.ib

df.sp.ib$Value <- as.character(df.sp.ib$Value)
df.sp.ib$Value [grepl('MPI_*', df.sp.ib$Value)] <- 'MPI'

df.sp.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.sp.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.sp.ib;
df.percent.sp.ib

df.sp.ib$Value <- as.character(df.sp.ib$Value)
df.sp.ib$Value [grepl('MPI', df.sp.ib$Value)] <- 'Computing'

df.sp.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.sp.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.sp.ib

df.sp.ipoib <- read_csv("LOGS/TRACE/charac_sp.ipoib/charac_sp.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "SP.ipoib") %>%
  select(Rank, everything())
df.sp.ipoib

df.sp.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.sp.ipoib

df.sp.ipoib$Value <- as.character(df.sp.ipoib$Value)
df.sp.ipoib$Value [grepl('MPI_*', df.sp.ipoib$Value)] <- 'MPI'

df.sp.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.sp.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.sp.ipoib;
df.percent.sp.ipoib

df.sp.ipoib$Value <- as.character(df.sp.ipoib$Value)
df.sp.ipoib$Value [grepl('MPI', df.sp.ipoib$Value)] <- 'Computing'

df.sp.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.sp.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.sp.ipoib

df.sp.eth <- read_csv("LOGS/TRACE/charac_sp.eth/charac_sp.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "SP.eth") %>%
  select(Rank, everything())
df.sp.eth

df.sp.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.sp.eth

df.sp.eth$Value <- as.character(df.sp.eth$Value)
df.sp.eth$Value [grepl('MPI_*', df.sp.eth$Value)] <- 'MPI'

df.sp.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.sp.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.sp.eth;
df.percent.sp.eth

df.sp.eth$Value <- as.character(df.sp.eth$Value)
df.sp.eth$Value [grepl('MPI', df.sp.eth$Value)] <- 'Computing'

df.sp.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.sp.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.sp.eth

df <- rbind(df.comp.sp.eth, df.comp.sp.ib, df.comp.sp.ipoib, df.percent.sp.eth, df.percent.sp.ib, df.percent.sp.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

#+RESULTS:
[[file:R/PLOTS/SP.charac.percentage.png]]

**** MG-CG-LU-BT
***** Read CSVs
#+begin_src R :results output :session *R* :exports both
options(crayon.enabled=FALSE)
suppressMessages(library(tidyverse))
df.mg <- read_csv("LOGS/TRACE/charac_mg.eth/charac_mg.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "MG") %>%
  select(Rank, everything())
df.mg

df.cg <- read_csv("LOGS/TRACE/charac_cg.eth/charac_cg.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "CG") %>%
  select(Rank, everything())
df.cg

df.lu <- read_csv("LOGS/TRACE/charac_lu.eth/charac_lu.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "LU") %>%
  select(Rank, everything())
df.lu

df.bt <- read_csv("LOGS/TRACE/charac_bt.eth/charac_bt.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "BT") %>%
  select(Rank, everything())
df.bt
#+end_src

#+RESULTS:
#+begin_example

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 3,102,496 x 6
    Rank Start   End Duration Value          App  
   <
<
<
   <
<
         <chr>
 1    99 0.866  1.61 0.741    MPI_Init       MG   
 2    99 1.61   1.61 0.000001 MPI_Comm_rank  MG   
 3    99 1.61   1.61 0        MPI_Comm_size  MG   
 4    99 1.61   1.61 0.00225  MPI_Comm_split MG   
 5    99 1.61   1.61 0.000244 MPI_Barrier    MG   
 6    99 1.61   1.61 0.00224  MPI_Bcast      MG   
 7    99 1.61   1.61 0.000049 MPI_Bcast      MG   
 8    99 1.61   1.61 0.000092 MPI_Bcast      MG   
 9    99 1.61   1.61 0.000150 MPI_Bcast      MG   
10    99 1.61   1.61 0.000042 MPI_Bcast      MG   
# … with 3,102,486 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 13,265,024 x 6
    Rank Start   End Duration Value         App  
   <
<
<
   <
<
        <chr>
 1    99 0.127 0.895 0.768    MPI_Init      CG   
 2    99 0.895 0.895 0.000001 MPI_Comm_rank CG   
 3    99 0.895 0.895 0        MPI_Comm_size CG   
 4    99 0.895 0.898 0.00324  MPI_Bcast     CG   
 5    99 8.18  8.18  0.000291 MPI_Irecv     CG   
 6    99 8.18  8.18  0.000118 MPI_Send      CG   
 7    99 8.18  8.20  0.0209   MPI_Wait      CG   
 8    99 8.20  8.20  0.00001  MPI_Irecv     CG   
 9    99 8.20  8.20  0.000029 MPI_Send      CG   
10    99 8.20  8.20  0.000002 MPI_Wait      CG   
# … with 13,265,014 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 113,834,493 x 6
    Rank Start   End Duration Value         App  
   <
<
<
   <
<
        <chr>
 1    99 0.743  1.57 0.830    MPI_Init      LU   
 2    99 1.57   1.57 0.000001 MPI_Comm_rank LU   
 3    99 1.57   1.57 0        MPI_Comm_size LU   
 4    99 1.57   1.57 0.00151  MPI_Bcast     LU   
 5    99 1.57   1.57 0.000103 MPI_Bcast     LU   
 6    99 1.57   1.57 0.000085 MPI_Bcast     LU   
 7    99 1.57   1.57 0.000051 MPI_Bcast     LU   
 8    99 1.57   1.57 0.000098 MPI_Bcast     LU   
 9    99 1.57   1.57 0.000013 MPI_Bcast     LU   
10    99 1.57   1.57 0.000086 MPI_Bcast     LU   
# … with 113,834,483 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 10,016,496 x 6
    Rank Start   End Duration Value          App  
   <
<
<
   <
<
         <chr>
 1   143 0.893  1.72 0.822    MPI_Init       BT   
 2   143 1.72   1.72 0.000001 MPI_Comm_size  BT   
 3   143 1.72   1.72 0        MPI_Comm_rank  BT   
 4   143 1.72   1.72 0.00260  MPI_Comm_split BT   
 5   143 1.72   1.72 0        MPI_Comm_size  BT   
 6   143 1.72   1.72 0.00188  MPI_Comm_dup   BT   
 7   143 1.72   1.72 0.00180  MPI_Comm_dup   BT   
 8   143 1.72   1.72 0.00143  MPI_Bcast      BT   
 9   143 1.72   1.72 0.000151 MPI_Bcast      BT   
10   143 1.72   1.72 0.000002 MPI_Bcast      BT   
# … with 10,016,486 more rows
#+end_example

***** Plot
#+begin_src R :results output graphics :file R/PLOTS/MG-CG-LU-BT.charac.png :exports both :width 800 :height 400 :session *R* 
df <- rbind(df.mg, df.cg, df.lu, df.bt)

df %>%
  filter(Value != "MPI_Finalize") %>%
  group_by(Rank,App) %>%
  summarize(MPI.Time = sum(Duration),
            Full.Time = max(End) - min(Start)) %>%
  mutate(Compute.Time = Full.Time - MPI.Time) %>%
  mutate(Comm.Ratio = MPI.Time / Full.Time * 100) %>%
  arrange(Rank) -> df.timings;
df.timings

df %>%
  group_by(Rank,App) %>%
  summarize(Time = max(End) - min(Start) - sum(Duration)) %>%
  mutate(Value = "Computing") -> df.compute
df.compute

df %>%
  filter(Value != "MPI_Finalize") %>%
  group_by(Rank,Value,App) %>%
  summarize(Time = sum(Duration)) -> df.communication;

df.communication$Value <- as.character(df.communication$Value)
df.communication$Value [grepl('MPI_*', df.communication$Value)] <- 'MPI'

df.communication %>%
  group_by(Rank, Value,App) %>%
  summarize(Time = sum(Time)) -> df.communication;

count <- 0
breaks_fun <- function(x) {
  count <<- count + 1L
  switch(
    count,
    c(0,70,143),
    c(0,60,127),
    c(0,60,127),
    c(0,60,127)
  )
}

count1 <- 0
breaks_fun1 <- function(x) {
  count1 <<- count1 + 1L
  switch(
    count1,
    c(0,110,220,330,440,550),
    c(0,200,400,600,800),
    c(0,100,200,300),
    c(0,20,40,60,80)
  )
}

df.compute %>%
  bind_rows(df.communication) %>%
  ggplot(aes(x = Rank, y = Time, fill=Value)) +
  geom_bar(stat='identity', width=1) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  theme_bw() +
  theme(legend.position="top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
        labs(x="Number of MPI Ranks", y="Execution Time in Seconds") +
        facet_wrap(facets= ~ App, scales="free", nrow=1) +
        scale_x_continuous(breaks = breaks_fun, limits = c(0, NA)) +
        scale_y_continuous(breaks = breaks_fun1, limits = c(0, NA)) + 
        theme(strip.text.x=element_text(size=18),
        strip.background=element_rect(fill='#F5F5F5'))

#+end_src

#+RESULTS:
[[file:R/PLOTS/MG-CG-LU-BT.charac.png]]

***** Percentage
#+begin_src R :results output graphics :file R/PLOTS/MG-CG-LU-BT.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.bt <- read_csv("LOGS/TRACE/charac_bt.eth/charac_bt.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "BT") %>%
  select(Rank, everything())
df.bt

df.bt %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.bt

df.bt$Value <- as.character(df.bt$Value)
df.bt$Value [grepl('MPI_*', df.bt$Value)] <- 'MPI'

df.bt %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.bt$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.bt;
df.percent.bt

df.bt$Value <- as.character(df.bt$Value)
df.bt$Value [grepl('MPI', df.bt$Value)] <- 'Computing'

df.bt %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.bt$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.bt

df.mg <- read_csv("LOGS/TRACE/charac_mg.eth/charac_mg.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "MG") %>%
  select(Rank, everything())
df.mg

df.mg %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.mg

df.mg$Value <- as.character(df.mg$Value)
df.mg$Value [grepl('MPI_*', df.mg$Value)] <- 'MPI'

df.mg %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.mg$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.mg;
df.percent.mg

df.mg$Value <- as.character(df.mg$Value)
df.mg$Value [grepl('MPI', df.mg$Value)] <- 'Computing'

df.mg %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.mg$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.mg

df.cg <- read_csv("LOGS/TRACE/charac_cg.eth/charac_cg.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "CG") %>%
  select(Rank, everything())
df.cg

df.cg %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.cg

df.cg$Value <- as.character(df.cg$Value)
df.cg$Value [grepl('MPI_*', df.cg$Value)] <- 'MPI'

df.cg %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.cg$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.cg;
df.percent.cg

df.cg$Value <- as.character(df.cg$Value)
df.cg$Value [grepl('MPI', df.cg$Value)] <- 'Computing'

df.cg %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.cg$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.cg

df.lu <- read_csv("LOGS/TRACE/charac_lu.eth/charac_lu.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "LU") %>%
  select(Rank, everything())
df.lu

df.lu %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.lu

df.lu$Value <- as.character(df.lu$Value)
df.lu$Value [grepl('MPI_*', df.lu$Value)] <- 'MPI'

df.lu %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.lu$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.lu;
df.percent.lu

df.lu$Value <- as.character(df.lu$Value)
df.lu$Value [grepl('MPI', df.lu$Value)] <- 'Computing'

df.lu %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.lu$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.lu

df <- rbind(df.comp.bt,df.comp.cg,df.comp.lu, df.comp.mg, df.percent.bt, df.percent.cg, df.percent.lu, df.percent.mg)

  ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")
#+end_src

#+RESULTS:
[[file:R/PLOTS/MG-CG-LU-BT.charac.percentage.png]]

***** MG-Percentage
#+begin_src R :results output graphics :file R/PLOTS/MG.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.mg.ib <- read_csv("LOGS/TRACE/charac_mg.ib/charac_mg.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "MG.ib") %>%
  select(Rank, everything())
df.mg.ib

df.mg.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.mg.ib

df.mg.ib$Value <- as.character(df.mg.ib$Value)
df.mg.ib$Value [grepl('MPI_*', df.mg.ib$Value)] <- 'MPI'

df.mg.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.mg.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.mg.ib;
df.percent.mg.ib

df.mg.ib$Value <- as.character(df.mg.ib$Value)
df.mg.ib$Value [grepl('MPI', df.mg.ib$Value)] <- 'Computing'

df.mg.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.mg.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.mg.ib

df.mg.ipoib <- read_csv("LOGS/TRACE/charac_mg.ipoib/charac_mg.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "MG.ipoib") %>%
  select(Rank, everything())
df.mg.ipoib

df.mg.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.mg.ipoib

df.mg.ipoib$Value <- as.character(df.mg.ipoib$Value)
df.mg.ipoib$Value [grepl('MPI_*', df.mg.ipoib$Value)] <- 'MPI'

df.mg.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.mg.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.mg.ipoib;
df.percent.mg.ipoib

df.mg.ipoib$Value <- as.character(df.mg.ipoib$Value)
df.mg.ipoib$Value [grepl('MPI', df.mg.ipoib$Value)] <- 'Computing'

df.mg.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.mg.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.mg.ipoib

df.mg.eth <- read_csv("LOGS/TRACE/charac_mg.eth/charac_mg.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "MG.eth") %>%
  select(Rank, everything())
df.mg.eth

df.mg.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.mg.eth

df.mg.eth$Value <- as.character(df.mg.eth$Value)
df.mg.eth$Value [grepl('MPI_*', df.mg.eth$Value)] <- 'MPI'

df.mg.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.mg.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.mg.eth;
df.percent.mg.eth

df.mg.eth$Value <- as.character(df.mg.eth$Value)
df.mg.eth$Value [grepl('MPI', df.mg.eth$Value)] <- 'Computing'

df.mg.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.mg.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.mg.eth

df <- rbind(df.comp.mg.eth, df.comp.mg.ib, df.comp.mg.ipoib, df.percent.mg.eth, df.percent.mg.ib, df.percent.mg.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

***** CG-Percentage
#+begin_src R :results output graphics :file R/PLOTS/CG.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.cg.ib <- read_csv("LOGS/TRACE/charac_cg.ib/charac_cg.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "CG.ib") %>%
  select(Rank, everything())
df.cg.ib

df.cg.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.cg.ib

df.cg.ib$Value <- as.character(df.cg.ib$Value)
df.cg.ib$Value [grepl('MPI_*', df.cg.ib$Value)] <- 'MPI'

df.cg.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.cg.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.cg.ib;
df.percent.cg.ib

df.cg.ib$Value <- as.character(df.cg.ib$Value)
df.cg.ib$Value [grepl('MPI', df.cg.ib$Value)] <- 'Computing'

df.cg.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.cg.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.cg.ib

df.cg.ipoib <- read_csv("LOGS/TRACE/charac_cg.ipoib/charac_cg.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "CG.ipoib") %>%
  select(Rank, everything())
df.cg.ipoib

df.cg.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.cg.ipoib

df.cg.ipoib$Value <- as.character(df.cg.ipoib$Value)
df.cg.ipoib$Value [grepl('MPI_*', df.cg.ipoib$Value)] <- 'MPI'

df.cg.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.cg.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.cg.ipoib;
df.percent.cg.ipoib

df.cg.ipoib$Value <- as.character(df.cg.ipoib$Value)
df.cg.ipoib$Value [grepl('MPI', df.cg.ipoib$Value)] <- 'Computing'

df.cg.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.cg.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.cg.ipoib

df.cg.eth <- read_csv("LOGS/TRACE/charac_cg.eth/charac_cg.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "CG.eth") %>%
  select(Rank, everything())
df.cg.eth

df.cg.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.cg.eth

df.cg.eth$Value <- as.character(df.cg.eth$Value)
df.cg.eth$Value [grepl('MPI_*', df.cg.eth$Value)] <- 'MPI'

df.cg.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.cg.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.cg.eth;
df.percent.cg.eth

df.cg.eth$Value <- as.character(df.cg.eth$Value)
df.cg.eth$Value [grepl('MPI', df.cg.eth$Value)] <- 'Computing'

df.cg.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.cg.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.cg.eth

df <- rbind(df.comp.cg.eth, df.comp.cg.ib, df.comp.cg.ipoib, df.percent.cg.eth, df.percent.cg.ib, df.percent.cg.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

***** LU-Percentage
#+begin_src R :results output graphics :file R/PLOTS/LU.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.lu.ib <- read_csv("LOGS/TRACE/charac_lu.ib/charac_lu.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "LU.ib") %>%
  select(Rank, everything())
df.lu.ib

df.lu.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.lu.ib

df.lu.ib$Value <- as.character(df.lu.ib$Value)
df.lu.ib$Value [grepl('MPI_*', df.lu.ib$Value)] <- 'MPI'

df.lu.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.lu.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.lu.ib;
df.percent.lu.ib

df.lu.ib$Value <- as.character(df.lu.ib$Value)
df.lu.ib$Value [grepl('MPI', df.lu.ib$Value)] <- 'Computing'

df.lu.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.lu.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.lu.ib

df.lu.ipoib <- read_csv("LOGS/TRACE/charac_lu.ipoib/charac_lu.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "LU.ipoib") %>%
  select(Rank, everything())
df.lu.ipoib

df.lu.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.lu.ipoib

df.lu.ipoib$Value <- as.character(df.lu.ipoib$Value)
df.lu.ipoib$Value [grepl('MPI_*', df.lu.ipoib$Value)] <- 'MPI'

df.lu.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.lu.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.lu.ipoib;
df.percent.lu.ipoib

df.lu.ipoib$Value <- as.character(df.lu.ipoib$Value)
df.lu.ipoib$Value [grepl('MPI', df.lu.ipoib$Value)] <- 'Computing'

df.lu.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.lu.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.lu.ipoib

df.lu.eth <- read_csv("LOGS/TRACE/charac_lu.eth/charac_lu.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "LU.eth") %>%
  select(Rank, everything())
df.lu.eth

df.lu.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.lu.eth

df.lu.eth$Value <- as.character(df.lu.eth$Value)
df.lu.eth$Value [grepl('MPI_*', df.lu.eth$Value)] <- 'MPI'

df.lu.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.lu.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.lu.eth;
df.percent.lu.eth

df.lu.eth$Value <- as.character(df.lu.eth$Value)
df.lu.eth$Value [grepl('MPI', df.lu.eth$Value)] <- 'Computing'

df.lu.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.lu.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.lu.eth

df <- rbind(df.comp.lu.eth, df.comp.lu.ib, df.comp.lu.ipoib, df.percent.lu.eth, df.percent.lu.ib, df.percent.lu.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

***** BT-Percentage
#+begin_src R :results output graphics :file R/PLOTS/BT.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.bt.ib <- read_csv("LOGS/TRACE/charac_bt.ib/charac_bt.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "BT.ib") %>%
  select(Rank, everything())
df.bt.ib

df.bt.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.bt.ib

df.bt.ib$Value <- as.character(df.bt.ib$Value)
df.bt.ib$Value [grepl('MPI_*', df.bt.ib$Value)] <- 'MPI'

df.bt.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.bt.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.bt.ib;
df.percent.bt.ib

df.bt.ib$Value <- as.character(df.bt.ib$Value)
df.bt.ib$Value [grepl('MPI', df.bt.ib$Value)] <- 'Computing'

df.bt.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.bt.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.bt.ib

df.bt.ipoib <- read_csv("LOGS/TRACE/charac_bt.ipoib/charac_bt.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "BT.ipoib") %>%
  select(Rank, everything())
df.bt.ipoib

df.bt.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.bt.ipoib

df.bt.ipoib$Value <- as.character(df.bt.ipoib$Value)
df.bt.ipoib$Value [grepl('MPI_*', df.bt.ipoib$Value)] <- 'MPI'

df.bt.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.bt.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.bt.ipoib;
df.percent.bt.ipoib

df.bt.ipoib$Vabte <- as.character(df.bt.ipoib$Value)
df.bt.ipoib$Value [grepl('MPI', df.bt.ipoib$Value)] <- 'Computing'

df.bt.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.bt.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.bt.ipoib

df.bt.eth <- read_csv("LOGS/TRACE/charac_bt.eth/charac_bt.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "BT.eth") %>%
  select(Rank, everything())
df.bt.eth

df.bt.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.bt.eth

df.bt.eth$Value <- as.character(df.bt.eth$Value)
df.bt.eth$Value [grepl('MPI_*', df.bt.eth$Value)] <- 'MPI'

df.bt.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.bt.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.bt.eth;
df.percent.bt.eth

df.bt.eth$Value <- as.character(df.bt.eth$Value)
df.bt.eth$Value [grepl('MPI', df.bt.eth$Value)] <- 'Computing'

df.bt.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.bt.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.bt.eth

df <- rbind(df.comp.bt.eth, df.comp.bt.ib, df.comp.bt.ipoib, df.percent.bt.eth, df.percent.bt.ib, df.percent.bt.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src

**** Alya-IMB
***** Read CSVs
#+begin_src R :results output :session *R* :exports both
options(crayon.enabled=FALSE)
suppressMessages(library(tidyverse))
df.imb.CPU <- read_csv("LOGS/TRACE/charac_imb_CPU.eth/charac_imb_CPU.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "ImbBench-CPU\n8Level") %>%
  select(Rank, everything())
df.imb.CPU

df.imb.mem <- read_csv("LOGS/TRACE/charac_imb_memory.eth/charac_imb_memory.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "ImbBench-Memory\n8Level") %>%
  select(Rank, everything())
df.imb.mem

df.alya <- read_csv("LOGS/TRACE/charac_alya.eth/charac_alya.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "Alya") %>%
  select(Rank, everything())
df.alya
#+end_src

#+RESULTS:
#+begin_example

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 640 x 6
    Rank Start   End Duration Value         App                   
   <
<
<
   <
<
        <
                
 1   159  1.04  1.96 0.924    MPI_Init      "ImbBench-CPU\n8Level"
 2   159  1.96  1.96 0.000001 MPI_Comm_size "ImbBench-CPU\n8Level"
 3   159  1.96  1.96 0.000001 MPI_Comm_rank "ImbBench-CPU\n8Level"
 4   159 11.9  12.6  0.691    MPI_Finalize  "ImbBench-CPU\n8Level"
 5   158  1.04  1.96 0.923    MPI_Init      "ImbBench-CPU\n8Level"
 6   158  1.96  1.96 0.000001 MPI_Comm_size "ImbBench-CPU\n8Level"
 7   158  1.96  1.96 0        MPI_Comm_rank "ImbBench-CPU\n8Level"
 8   158 11.1  12.6  1.46     MPI_Finalize  "ImbBench-CPU\n8Level"
 9   157  1.06  1.96 0.908    MPI_Init      "ImbBench-CPU\n8Level"
10   157  1.96  1.96 0.000001 MPI_Comm_size "ImbBench-CPU\n8Level"
# … with 630 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 640 x 6
    Rank  Start   End  Duration Value         App                      
   <
 <
<
    <
<
        <
                   
 1   159  0.915  1.80  0.888    MPI_Init      "ImbBench-Memory\n8Level"
 2   159  1.80   1.80  0.000001 MPI_Comm_size "ImbBench-Memory\n8Level"
 3   159  1.80   1.80  0        MPI_Comm_rank "ImbBench-Memory\n8Level"
 4   159 87.1   94.2   7.10     MPI_Finalize  "ImbBench-Memory\n8Level"
 5   158  0.910  1.80  0.893    MPI_Init      "ImbBench-Memory\n8Level"
 6   158  1.80   1.80  0.000001 MPI_Comm_size "ImbBench-Memory\n8Level"
 7   158  1.80   1.80  0        MPI_Comm_rank "ImbBench-Memory\n8Level"
 8   158 72.6   94.2  21.6      MPI_Finalize  "ImbBench-Memory\n8Level"
 9   157  0.913  1.80  0.889    MPI_Init      "ImbBench-Memory\n8Level"
10   157  1.80   1.80  0.000001 MPI_Comm_size "ImbBench-Memory\n8Level"
# … with 630 more rows

Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  X3 = col_character(),
  X4 = col_double(),
  X5 = col_double(),
  X6 = col_double(),
  X7 = col_double(),
  X8 = col_character()
)

# A tibble: 24,550,772 x 6
    Rank Start   End Duration Value         App  
   <
<
<
   <
<
        <chr>
 1   159  1.61  2.52 0.913    MPI_Init      Alya 
 2   159  2.52  2.52 0.000001 MPI_Comm_size Alya 
 3   159  2.52  2.52 0        MPI_Comm_rank Alya 
 4   159  2.52  2.52 0.000029 MPI_Gather    Alya 
 5   159  2.52  2.52 0.000933 MPI_Bcast     Alya 
 6   159  2.52  2.52 0.000216 MPI_Scatter   Alya 
 7   159  2.52  2.52 0        MPI_Comm_size Alya 
 8   159  2.52  2.52 0        MPI_Comm_rank Alya 
 9   159  2.52  2.52 0.00002  MPI_Gather    Alya 
10   159  2.52  2.52 0.00073  MPI_Bcast     Alya 
# … with 24,550,762 more rows
#+end_example

***** Plot
#+begin_src R :results output graphics :file R/PLOTS/Alya-IMB.charac.png :exports both :width 800 :height 400 :session *R* 
df <- rbind(df.imb.CPU, df.imb.mem, df.alya)

df %>%
  filter(Value != "MPI_Finalize") %>%
  group_by(Rank,App) %>%
  summarize(MPI.Time = sum(Duration),
            Full.Time = max(End) - min(Start)) %>%
  mutate(Compute.Time = Full.Time - MPI.Time) %>%
  mutate(Comm.Ratio = MPI.Time / Full.Time * 100) %>%
  arrange(Rank) -> df.timings;
df.timings

df %>%
  group_by(Rank,App) %>%
  summarize(Time = max(End) - min(Start) - sum(Duration)) %>%
  mutate(Value = "Computing") -> df.compute
df.compute

df %>%
  filter(Value != "MPI_Finalize") %>%
  group_by(Rank,Value,App) %>%
  summarize(Time = sum(Duration)) -> df.communication;

df.communication$Value <- as.character(df.communication$Value)
df.communication$Value [grepl('MPI_*', df.communication$Value)] <- 'MPI'

df.communication %>%
  group_by(Rank, Value,App) %>%
  summarize(Time = sum(Time)) -> df.communication;

count <- 0
breaks_fun <- function(x) {
  count <<- count + 1L
  switch(
    count,
    c(0,50,100,159),
    c(0,50,100,159),
    c(0,50,100,159)
  )
}

count1 <- 0
breaks_fun1 <- function(x) {
  count1 <<- count1 + 1L
  switch(
    count1,
    c(0,100,200,300),
    c(0,3,6,9,12),
    c(0,30,60,90)
  )
}


df.compute %>%
  bind_rows(df.communication) %>%
  ggplot(aes(x = Rank, y = Time, fill=Value)) +
  geom_bar(stat='identity', width=1) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_x_continuous(breaks=c(0,53,106,159)) +
  theme_bw() +
  theme(legend.position="top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
        labs(x="Number of MPI Ranks", y="Execution Time in Seconds") +
        facet_wrap(facets= ~ App, scales="free") +
        scale_x_continuous(breaks = breaks_fun, limits = c(0, NA)) +
        scale_y_continuous(breaks = breaks_fun1, limits = c(0, NA)) + 
        theme(strip.text.x=element_text(size=18),
        strip.background=element_rect(fill='#F5F5F5'))

#+end_src

#+RESULTS:
[[file:R/PLOTS/Alya-IMB.charac.png]]
***** Percentage
#+begin_src R :results output graphics :file R/PLOTS/Alya-IMB.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.alya <- read_csv("LOGS/TRACE/charac_alya.eth/charac_alya.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "Alya") %>%
  select(Rank, everything())
df.alya

df.alya %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.alya

df.alya$Value <- as.character(df.alya$Value)
df.alya$Value [grepl('MPI_*', df.alya$Value)] <- 'MPI'

df.alya %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.alya$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.alya;
df.percent.alya

df.alya$Value <- as.character(df.alya$Value)
df.alya$Value [grepl('MPI', df.alya$Value)] <- 'Computing'

df.alya %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.alya$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.alya

df.imb_cpu <- read_csv("LOGS/TRACE/charac_imb_CPU.eth/charac_imb_CPU.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "ImbBench-CPU\n8Level") %>%
  select(Rank, everything())
df.imb_cpu

df.imb_cpu %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_cpu

df.imb_cpu$Value <- as.character(df.imb_cpu$Value)
df.imb_cpu$Value [grepl('MPI_*', df.imb_cpu$Value)] <- 'MPI'

df.imb_cpu %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_cpu$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_cpu;
df.percent.imb_cpu

df.imb_cpu$Value <- as.character(df.imb_cpu$Value)
df.imb_cpu$Value [grepl('MPI', df.imb_cpu$Value)] <- 'Computing'

df.imb_cpu %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_cpu$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_cpu

df.imb_memory <- read_csv("LOGS/TRACE/charac_imb_memory.eth/charac_imb_memory.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "ImbBench-Memory\n8Level") %>%
  select(Rank, everything())
df.imb_memory

df.imb_memory %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_memory

df.imb_memory$Value <- as.character(df.imb_memory$Value)
df.imb_memory$Value [grepl('MPI_*', df.imb_memory$Value)] <- 'MPI'

df.imb_memory %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_memory$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_memory;
df.percent.imb_memory

df.imb_memory$Value <- as.character(df.imb_memory$Value)
df.imb_memory$Value [grepl('MPI', df.imb_memory$Value)] <- 'Computing'

df.imb_memory %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_memory$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_memory

df <- rbind(df.comp.alya,df.comp.imb_cpu,df.comp.imb_memory, df.percent.alya, df.percent.imb_cpu, df.percent.imb_memory)

  ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")
#+end_src

#+RESULTS:
[[file:Alya-IMB.charac.percentage.png]]
***** Alya-Percentage
#+begin_src R :results output graphics :file R/PLOTS/Alya.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.alya.ib <- read_csv("LOGS/TRACE/charac_alya.ib/charac_alya.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "Alya.ib") %>%
  select(Rank, everything())
df.alya.ib

df.alya.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.alya.ib

df.alya.ib$Value <- as.character(df.alya.ib$Value)
df.alya.ib$Value [grepl('MPI_*', df.alya.ib$Value)] <- 'MPI'

df.alya.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.alya.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.alya.ib;
df.percent.alya.ib

df.alya.ib$Value <- as.character(df.alya.ib$Value)
df.alya.ib$Value [grepl('MPI', df.alya.ib$Value)] <- 'Computing'

df.alya.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.alya.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.alya.ib

df.alya.ipoib <- read_csv("LOGS/TRACE/charac_alya.ipoib/charac_alya.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "Alya.ipoib") %>%
  select(Rank, everything())
df.alya.ipoib

df.alya.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.alya.ipoib

df.alya.ipoib$Value <- as.character(df.alya.ipoib$Value)
df.alya.ipoib$Value [grepl('MPI_*', df.alya.ipoib$Value)] <- 'MPI'

df.alya.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.alya.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.alya.ipoib;
df.percent.alya.ipoib

df.alya.ipoib$Value <- as.character(df.alya.ipoib$Value)
df.alya.ipoib$Value [grepl('MPI', df.alya.ipoib$Value)] <- 'Computing'

df.alya.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.alya.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.alya.ipoib

df.alya.eth <- read_csv("LOGS/TRACE/charac_alya.eth/charac_alya.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "Alya.eth") %>%
  select(Rank, everything())
df.alya.eth

df.alya.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.alya.eth

df.alya.eth$Value <- as.character(df.alya.eth$Value)
df.alya.eth$Value [grepl('MPI_*', df.alya.eth$Value)] <- 'MPI'

df.alya.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.alya.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.alya.eth;
df.percent.alya.eth

df.alya.eth$Value <- as.character(df.alya.eth$Value)
df.alya.eth$Value [grepl('MPI', df.alya.eth$Value)] <- 'Computing'

df.alya.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.alya.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.alya.eth

df <- rbind(df.comp.alya.eth, df.comp.alya.ib, df.comp.alya.ipoib, df.percent.alya.eth, df.percent.alya.ib, df.percent.alya.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src
***** IMB-CPU-Percentage
#+begin_src R :results output graphics :file R/PLOTS/imb_CPU.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.imb_CPU.ib <- read_csv("LOGS/TRACE/charac_imb_CPU.ib/charac_imb_CPU.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IMB_CPU.ib") %>%
  select(Rank, everything())
df.imb_CPU.ib

df.imb_CPU.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_CPU.ib

df.imb_CPU.ib$Value <- as.character(df.imb_CPU.ib$Value)
df.imb_CPU.ib$Value [grepl('MPI_*', df.imb_CPU.ib$Value)] <- 'MPI'

df.imb_CPU.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_CPU.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_CPU.ib;
df.percent.imb_CPU.ib

df.imb_CPU.ib$Value <- as.character(df.imb_CPU.ib$Value)
df.imb_CPU.ib$Value [grepl('MPI', df.imb_CPU.ib$Value)] <- 'Computing'

df.imb_CPU.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_CPU.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_CPU.ib

df.imb_CPU.ipoib <- read_csv("LOGS/TRACE/charac_imb_CPU.ipoib/charac_imb_CPU.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IMB_CPU.ipoib") %>%
  select(Rank, everything())
df.imb_CPU.ipoib

df.imb_CPU.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_CPU.ipoib

df.imb_CPU.ipoib$Value <- as.character(df.imb_CPU.ipoib$Value)
df.imb_CPU.ipoib$Value [grepl('MPI_*', df.imb_CPU.ipoib$Value)] <- 'MPI'

df.imb_CPU.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_CPU.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_CPU.ipoib;
df.percent.imb_CPU.ipoib

df.imb_CPU.ipoib$Value <- as.character(df.imb_CPU.ipoib$Value)
df.imb_CPU.ipoib$Value [grepl('MPI', df.imb_CPU.ipoib$Value)] <- 'Computing'

df.imb_CPU.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_CPU.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_CPU.ipoib

df.imb_CPU.eth <- read_csv("LOGS/TRACE/charac_imb_CPU.eth/charac_imb_CPU.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IMB_CPU.eth") %>%
  select(Rank, everything())
df.imb_CPU.eth

df.imb_CPU.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_CPU.eth

df.imb_CPU.eth$Value <- as.character(df.imb_CPU.eth$Value)
df.imb_CPU.eth$Value [grepl('MPI_*', df.imb_CPU.eth$Value)] <- 'MPI'

df.imb_CPU.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_CPU.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_CPU.eth;
df.percent.imb_CPU.eth

df.imb_CPU.eth$Value <- as.character(df.imb_CPU.eth$Value)
df.imb_CPU.eth$Value [grepl('MPI', df.imb_CPU.eth$Value)] <- 'Computing'

df.imb_CPU.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_CPU.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_CPU.eth

df <- rbind(df.comp.imb_CPU.eth, df.comp.imb_CPU.ib, df.comp.imb_CPU.ipoib, df.percent.imb_CPU.eth, df.percent.imb_CPU.ib, df.percent.imb_CPU.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src
***** IMB-Memory-Percentage
#+begin_src R :results output graphics :file R/PLOTS/imb_memory.charac.percentage.png :exports both :width 800 :height 400 :session *R* 
options(crayon.enabled=FALSE)
options(scipen = 999)
suppressMessages(library(tidyverse))
df.imb_memory.ib <- read_csv("LOGS/TRACE/charac_imb_memory.ib/charac_imb_memory.ib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IMB_Memory.ib") %>%
  select(Rank, everything())
df.imb_memory.ib

df.imb_memory.ib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_memory.ib

df.imb_memory.ib$Value <- as.character(df.imb_memory.ib$Value)
df.imb_memory.ib$Value [grepl('MPI_*', df.imb_memory.ib$Value)] <- 'MPI'

df.imb_memory.ib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_memory.ib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_memory.ib;
df.percent.imb_memory.ib

df.imb_memory.ib$Value <- as.character(df.imb_memory.ib$Value)
df.imb_memory.ib$Value [grepl('MPI', df.imb_memory.ib$Value)] <- 'Computing'

df.imb_memory.ib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_memory.ib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_memory.ib

df.imb_memory.ipoib <- read_csv("LOGS/TRACE/charac_imb_memory.ipoib/charac_imb_memory.ipoib.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IMB_Memory.ipoib") %>%
  select(Rank, everything())
df.imb_memory.ipoib

df.imb_memory.ipoib %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_memory.ipoib

df.imb_memory.ipoib$Value <- as.character(df.imb_memory.ipoib$Value)
df.imb_memory.ipoib$Value [grepl('MPI_*', df.imb_memory.ipoib$Value)] <- 'MPI'

df.imb_memory.ipoib %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_memory.ipoib$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_memory.ipoib;
df.percent.imb_memory.ipoib

df.imb_memory.ipoib$Value <- as.character(df.imb_memory.ipoib$Value)
df.imb_memory.ipoib$Value [grepl('MPI', df.imb_memory.ipoib$Value)] <- 'Computing'

df.imb_memory.ipoib %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_memory.ipoib$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_memory.ipoib

df.imb_memory.eth <- read_csv("LOGS/TRACE/charac_imb_memory.eth/charac_imb_memory.eth.csv", col_names = FALSE, progress=FALSE) %>%
  mutate(Rank = gsub("MPI Rank", "", X2)) %>%
  select(-X1, -X2, -X3, -X7) %>%
  rename(Start = X4,
         End = X5,
         Duration = X6,
         Value = X8) %>%
  mutate(Rank = as.integer(Rank)) %>%
  mutate(App = "IMB_Memory.eth") %>%
  select(Rank, everything())
df.imb_memory.eth

df.imb_memory.eth %>%
  group_by(Value,App) %>%
  filter(Value == "MPI_Finalize") %>%
  summarize(Total = sum(End))  -> df.total.imb_memory.eth

df.imb_memory.eth$Value <- as.character(df.imb_memory.eth$Value)
df.imb_memory.eth$Value [grepl('MPI_*', df.imb_memory.eth$Value)] <- 'MPI'

df.imb_memory.eth %>%
  group_by(Value,App) %>%
  summarize(MPI.Time = sum(Duration),
            Total = df.total.imb_memory.eth$Total,
            Percent=(MPI.Time*100)/Total) -> df.percent.imb_memory.eth;
df.percent.imb_memory.eth

df.imb_memory.eth$Value <- as.character(df.imb_memory.eth$Value)
df.imb_memory.eth$Value [grepl('MPI', df.imb_memory.eth$Value)] <- 'Computing'

df.imb_memory.eth %>%
  group_by(Value,App) %>%
  summarize(Total = df.total.imb_memory.eth$Total,
            MPI.Time = Total - sum(Duration),
            Percent=(MPI.Time*100)/Total) -> df.comp.imb_memory.eth

df <- rbind(df.comp.imb_memory.eth, df.comp.imb_memory.ib, df.comp.imb_memory.ipoib, df.percent.imb_memory.eth, df.percent.imb_memory.ib, df.percent.imb_memory.ipoib)

ggplot(df, aes(x=App, y=Percent, fill=Value)) + 
  geom_bar(position = "fill", stat = "identity", width = 0.3) +
  scale_fill_manual(values=c("#303030", "#BEBEBE")) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(legend.position = "top",
        legend.key = element_rect(colour = "grey"),
        legend.key.height = unit(0.5, "line"),
        legend.key.width = unit(4, "line"),
        legend.spacing = unit(100, "line"),
        plot.margin = unit(x = c(0, 0.2, 0, 0), units = "cm"),
        legend.margin=margin(c(0, 0, -8, 0)),
        axis.text.x = element_text(size =16, color = "black"),
        axis.text.y = element_text(size =16, color = "black"),
        axis.title=element_text(size=18), 
        legend.title = element_blank(),
        legend.text = element_text(color = "black", size = 18)) +
  labs(x="Applications", y="Operation Percentage")

#+end_src
